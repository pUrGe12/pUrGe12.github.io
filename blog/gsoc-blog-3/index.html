<!doctype html><html lang=en><head><script src="https://www.googletagmanager.com/gtag/js?id=G-EKTHKNJH0Q" async></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-EKTHKNJH0Q');</script><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>optimizing the UDP scanning part and minor adjustments</title><meta name=description><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/icons/site.webmanifest rel=manifest><link color=#5bbad5 href=/icons/safari-pinned-tab.svg rel=mask-icon><link rel="shortcut icon" href=/icons/favicon.ico><meta content=#00aba9 name=msapplication-TileColor><meta content=/icons/browserconfig.xml name=msapplication-config><meta content=#ffffff name=theme-color><link href=https://purge12.github.io//styles/styles.css rel=stylesheet><script>if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark')
    localStorage.setItem("theme", "dark")
  } else {
    document.documentElement.classList.remove('dark')
    localStorage.setItem("theme", "light")
  }</script><link href=https://purge12.github.io//hl-light.css id=hl rel=stylesheet><body class="antialiased text-slate-700 dark:text-slate-300 bg-white dark:bg-stone-900"><header><div class="bg-stone-300 dark:bg-stone-700 py-1"><div class="row justify-between max-w-prose m-auto px-5"><nav class="row items-center gap-2"><img alt=avatar class=h-12 src=https://purge12.github.io//img/avatar.webp><div><a class=text-xl href=https://purge12.github.io/>home</a><span class=text-xl> > </span><a class=text-xl href=https://purge12.github.io//blog>blog</a><span class=text-xl> > </span><a class=text-xl href=https://purge12.github.io//blog/gsoc-blog-3>gsoc-blog-3</a></div></nav><div class="row items-center gap-3"><button aria-label="theme switch" data-moon-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg>' data-sun-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg>' id=theme-toggle><svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.5 xmlns=http://www.w3.org/2000/svg><path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" stroke-linecap=round stroke-linejoin=round /></svg></button></div></div></div></header><div class="flex justify-center items-center w-full"><main class="max-w-prose px-4 w-full"><div data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
</svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
</svg>' id=copy-cfg style=display:none></div><article class="col w-full" data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 19.5l-15-15m0 0v11.25m0-11.25h11.25" />
</svg>' id=post><section aria-label="Article Info" class="col pt-7 gap-4 mb-10"><h1 class=text-2xl>optimizing the UDP scanning part and minor adjustments</h1><div class="row justify-between"><div><span class="text-lg text-stone-400" id=publish>2025-05-29</span></div><div class="flex gap-2"><a class="text-lg tl-link" href=https://purge12.github.io//tags/networks># Networks</a><a class="text-lg tl-link" href=https://purge12.github.io//tags/blog># blog</a></div></div></section><section aria-label=Article class=tl-prose><p>May 29th 2025,<p>New day but old stuff.<p>Another optimization, we don’t have to extract the UDP probes all the time! That’s just time wasting. Since the port number doesn’t matter here, we need to just extract it once and keep using that.<p>I managed that. But I think all the threads are still running all the ports. I mean think about it, its totally unncessary! Why, if this is the same scenario as the tcp_scan part?<p>Let’s go over what actually happens:<ol><li>All threads will have to call the extract_udp_probes function. This is bad. Not ideal. No. I should have it like, I have one extracted list, and I pass it to all threads.<li>All threads then run from 1 to whatever the end port is in port.yaml. Not at all ideal! I will have to check how tcp_send_connect_and_recieve does it and just match that.</ol><p>Alright so in order to make extract_udp_probe really not be running for all the threads, I just need to add that in the sub_step just like I had for the probes.<p>I did this, basically did all the extraction in <code>app.py</code> and added that as a parameter itself. Now, fix the threading issue.<hr><p>Bruh! I just realised, I am doing everything fine only! I printed which ports I am testing with each thread and I realised that we’re testing 1 port with 1 thread, just like it normally works. But earlier, we have just 1 probe, now we have multiple. So, each thread for its own port it trying to throw all probes and see. This is fine I guess, I am not sure if we can parallize this further.<p>or if I even have to. Alright, so now I only have to see why it won’t close nicely when I press ctrl+c, and if verbose works with this.<p>Yeah, verbose doesn’t work. I will have to see this. With <code>tcp_send_connect_and_recieve</code> verbose works perfectly as in, we can see which request is being sent and to where. This is probably because I am not returning anything from the function and I haven’t added the code to base.py as well. So, it doesn’t really know what to do with this except printing the debugging print statements.<p>Bro also, how do we exactly detect UDP if they don’t reply? I think they reply validly if the service is running and the right probe is used. I setup a udp listener just to see and I am hitting the same port (8334).<hr><p>AHHH things work. I have a UDP echo server running using socat<p><code>socat -v UDP-RECVFROM:8334,reuseaddr EXEC:/bin/cat</code><p>Now, I ran into the real issues. I am recieving a response from the UDP server, so I hit this exception:<pre class=z-code><code><span class="z-text z-plain">Traceback (most recent call last):
</span><span class="z-text z-plain">  File "/usr/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
</span><span class="z-text z-plain">    self.run()
</span><span class="z-text z-plain">  File "/usr/lib/python3.10/threading.py", line 953, in run
</span><span class="z-text z-plain">    self._target(*self._args, **self._kwargs)
</span><span class="z-text z-plain">  File "/home/purge/Nettacker/nettacker/core/lib/base.py", line 339, in run
</span><span class="z-text z-plain">    return self.process_conditions(
</span><span class="z-text z-plain">  File "/home/purge/Nettacker/nettacker/core/lib/base.py", line 249, in process_conditions
</span><span class="z-text z-plain">    log.verbose_info(json.dumps(event))
</span><span class="z-text z-plain">  File "/usr/lib/python3.10/json/__init__.py", line 231, in dumps
</span><span class="z-text z-plain">    return _default_encoder.encode(obj)
</span><span class="z-text z-plain">  File "/usr/lib/python3.10/json/encoder.py", line 199, in encode
</span><span class="z-text z-plain">    chunks = self.iterencode(o, _one_shot=True)
</span><span class="z-text z-plain">  File "/usr/lib/python3.10/json/encoder.py", line 257, in iterencode
</span><span class="z-text z-plain">    return _iterencode(o, 0)
</span><span class="z-text z-plain">  File "/usr/lib/python3.10/json/encoder.py", line 179, in default
</span><span class="z-text z-plain">    raise TypeError(f'Object of type {o.__class__.__name__} '
</span><span class="z-text z-plain">TypeError: Object of type bytes is not JSON serializable
</span></code></pre><p>Hmm. Interesting.<p>What if I send TCP probes to the UDP echo server? It just silently drops! YESSSSS! Finally some validation that UDP probes work!<p>This is the normal event:<pre class=z-code><code><span class="z-text z-plain">This is the event that was failing: {'timeout': 3.0, 'host': '127.0.0.1', 'port': 613, 'method': 'tcp_connect_send_and_receive', 'response': {'condition_type': 'or', 'log': "response_dependent['service']", 'conditions_results': [], 'ssl_flag': False}, 'method_version': 'tcp_version_scan'}
</span></code></pre><p>The event I have that fails has this big ass section called udp_probes! AHHH, I need to delete that in base.py. Yes. The problem probably is that I have added udp_probes in the sub_step, I should delete it from there once the scans are completed. Let’s try now. Alright, this sort of works, I am now facing another issue. Let me articulate this once after running.<p>Firstly, the <code>method</code> name is wrong, <code>method_version</code> shouldn’t be set. I am getting the same response from this as I get from a port_scan for a port that is closed.<hr><p>3rd June 2025<p>okay, its been a while, with new clarity I can safetly say that verbose mode doesn’t work. The reason i get <code>method_version</code> is because it is correct! I am getting verbose output only for <code>tcp_connect_send_and_recieve</code>. I will have to see to this. I think, other than that, should be fine. This is cause if I run the command<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">python3</span></span><span class="z-meta z-function-call z-arguments z-shell"> nettacker.py<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> 127.0.0.1<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span> port_scan<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>g</span> 8334<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> (-sU</span><span class="z-meta z-function-call z-shell"></span>)
</span></code></pre><p>With or without -sU, I get the same output (if I don’t print anything that is). Verbose needs to do better. Let’s first fix that okay. Let’s figure out how verbose works. Alright, so I get this. We use the <code>log = logger.get_logger()</code> and <code>log.verbose_event_info()</code> to make a verbose noise. The thing is that, this logging is not implemented in the socket side, rather its present in the app.py file.<p>So, the question then is, why is it not logging if everything starts from app.py. Hmm, will have to investigate. (At least this will also point to the right issue!) Also investigate why it returns immediately after a hit? I mean, its good but still. (Yeah this is sorted, this was because I was closing the socket after each hit)<p>Also, we can thread inside a thread. So parallelize the probe sending.<p>I shall parallelize tomorrow. I don’t understand why but when I am returning, suddenly I return with all the udp_probes, EVEN though I am deleting them (maybe I am readding them, or maybe its being done before removal).<hr><p>I have migrated all test cases to pytest based on what Mr. Arkadii told. I think its fine, not much work was involved in that. Additionally, I fixed all the reviewed PRs. Now, I am thinking I will help Mr. Sam with the database lock issues, he mentioned before he knows people who use it well, so he’ll probably ask them.<p>Meanwhile, I am working on getting the webserver parts ready. I will make a PR today itself, cause why not. I am thinking I will finish major “peripherals” as soon as possible, hopefully raise PRs for all of them before the end of this month itself. So, this gives me a lot of time to work on the major thing!<hr><p>11th June<p>Alright so my first 10 days are about to be over. I will make a small reflection tomorrow on what has been achieved and what remains. Yesterday I talked to Mr. Arkadii about using <a rel="noopener nofollow noreferrer" href=https://github.com/facebookresearch/hydra target=_blank>hydra</a> for Nettacker. He’s the major software guy so I figured he’ll be able to answer better. He said figure out if its the best solution and I don’t know if its the best, but I think it might help.<p>I have seen this being used in the breaching library and I was working with that for the genomics PPFL (this reminds me, I need tv do PCA and submit another result) and I have seen how easy the configurations become.<p>FUCK!!<p>My laptop has come from death. My screen died, then some RAM issues (blinking <code>caps lock</code> in HP laptops), then battery weak connections (I put surgical tape over it), but now it works. Turns out that if surgical tape can fix a lot of things. Also, removing and replugging your RAM will flush it and hence might work.<hr><p>I sent the Hydra implementation to Mr. Arkadii, I will keep on checking on that. Meanwhile, I did put up a PR for new output types, Mr. Sam seems to be confused. I will now show him my implementation for huey with flask, will send a video to demonstrate that. Its much easier this way. Let’s see what he thinks. Yepp, sent. I think its fine, I don’t know what else to do here. The user can clearly see what’s happening and that’s always good. Besides even if you need to use a different code (and not the GUI) you’ll still need to run the API server in some machine as there is no central server. This means, huey will just run like its doing rn on the server its being run on. Simple.<hr><p>Jun 18th<p>Its been 16 days since GSoC started. Honestly I am not happy with the progress (its been, uhh, slow. I have only 5 merged PRs now, that too all tests. I have 2 feature based open PRs though). I have shown my huey with flask implementation to Mr. Sam. He said we’ll meet tomorrow and discuss this further. So, lets see what feedback I get then. Today I am coming back to my UDP scan. Firstly, I am such an idiot for not mentioning the branch name!<p>branch: <code>code-refactor-version-scan-faster</code><p>Note, I just made a new push that reverts this back to the stage i had left it on (I had made a small mistake and pushed that too so when I came back to this, VIola! Suddently it was broken! I was getting errors, but that was because I was called <code>.getpeername</code> on a UDP socket which is fucking socketless. And my stupid ass didn’t even test this and directly pushed.)<p>Alright so, the next order of business is, I WANT port_scan to happen first! Lets work on that. Basically this should be the flow:<ol><li>It loads all the UDP probes at the start and shows to the user that, hehe it will take time, please be patient<li>Then it does a normal port_scan with TCP probes FIRST (unless -d is specified)<li>Then it tells the user its doing a UDP scan<li>Then it returns all the results together</ol><p>Alright. I figured this out. The problem is this:<ul><li><p>Since we are running multiple treads, each time it creates a tcp_send_connect_and_recieve connection, it sends the single probe, then immediately afterwards, it recieves or not a response (or connection refused error) and then it does the UDP probe (if the flag is called).</p><li><p>Since we’re sending like 100 probes per port for a single thread, it takes time. This means, each thread is now occupied with sending UDP probes. I think what we need to say is only after all the threads have fully finished port_scanning, perform the UDP scan.</p></ul><p>I have a plan<p>That is, create two run functions. one is <code>run_tcp_scan</code> and other is <code>run_udp_scan</code>. We perform the check inside <code>module.py</code> itself. Then we call run_tcp_scan by default. Then <code>IF</code> udp_scan is called for, we run that as well. only after all the threading for tcp_scan is done…<hr><p>I did this part! Now, it runs tcp scan with all threads, then it runs UDP scan as requested.<blockquote><p>Now, one small issue remains!</blockquote><p>That is, IT TAKES WAYYYYYY too much time to finish UDP scanning. Because, even thought we have multiple threading working on this, each thread still has to send 100 different probes! This takes a lot of time. I am thinking, can we do something like threading each thread? Yes, basically, parallelize the probe sending.<p>So, I did this also. But now I am facing a small issue with line 490 in socket.py. For some reason (after UDP scanning) its going into the regex matching part for which it requires “conditions” which I don’t have! I haven’t coded this part yet, but I don’t want it to match the conditions! or maybe, I will artificially add the conditions as and when needed. But for now, its somehow still going there (not sure why) and fucking up the code.<p>on the bright side, it seems like the parallelization does work. Let’s see that in more details when I fix this thingie.</section></article><hr class="h-px my-10 bg-slate-700 dark:bg-slate-300"><section aria-label="Subscription call-to-action"><div class="col gap-8"><p class="[&>a]:underline [&>a]:underline-offset-4 [&>a]:decoration-2 [&>a]:decoration-sky-500 [&>a]:dark:decoration-sky-400">Did you like this blogpost? Then consider catching up via LinkedIn or Github!<div class="flex gap-5"><form class="col gap-2 w-1/2" onsubmit="window.open('https://buttondown.com/achintya', 'popupwindow')" action=https://buttondown.com/api/emails/embed-subscribe/achintya method=post target=popupwindow><input aria-label="Email input field" class="p-2 bg-stone-300 dark:bg-stone-700n placeholder:text-slate-700 dark:placeholder:text-slate-900" placeholder="Enter your email address" id=bd-email name=email type=email><input class="rounded-md text-black dark:bg-sky-600 p-2 bg-sky-500" type=submit value=Subscribe></form><div class="flex justify-center items-center w-1/2"></div></div></div></section><div class="flex justify-center my-16"><button aria-label="back to top" id=back-to-top><svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.5 xmlns=http://www.w3.org/2000/svg><path d="M12 19.5v-15m0 0l-6.75 6.75M12 4.5l6.75 6.75" stroke-linecap=round stroke-linejoin=round /></svg></button></div><footer class="text-stone-400 dark:text-stone-400 row my-16 text-center"><div class=basis-full><p>© 2024-2025 Achintya Jai</div><div class=basis-full><div>Powered by <a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://www.getzola.org target=_blank>zola</a> and <a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://github.com/TeaDrinkingProgrammer/tranquil target=_blank>tranquil</a></div></div><div class=basis-full><a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://purge12.github.io//privacy target=_blank>Privacy Policy</a></div></footer></main></div><script src=https://purge12.github.io//js/post.js></script><script src=https://purge12.github.io//js/lightense.min.js></script><script src=https://purge12.github.io//js/main.js></script>