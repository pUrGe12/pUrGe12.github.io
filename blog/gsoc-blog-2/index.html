<!doctype html><html lang=en><head><script src="https://www.googletagmanager.com/gtag/js?id=G-EKTHKNJH0Q" async></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-EKTHKNJH0Q');</script><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>Problems in version and UDP scanning</title><meta name=description><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/icons/site.webmanifest rel=manifest><link color=#5bbad5 href=/icons/safari-pinned-tab.svg rel=mask-icon><link rel="shortcut icon" href=/icons/favicon.ico><meta content=#00aba9 name=msapplication-TileColor><meta content=/icons/browserconfig.xml name=msapplication-config><meta content=#ffffff name=theme-color><link href=https://purge12.github.io//styles/styles.css rel=stylesheet><script>if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark')
    localStorage.setItem("theme", "dark")
  } else {
    document.documentElement.classList.remove('dark')
    localStorage.setItem("theme", "light")
  }</script><link href=https://purge12.github.io//hl-light.css id=hl rel=stylesheet><body class="antialiased text-slate-700 dark:text-slate-300 bg-white dark:bg-stone-900"><header><div class="bg-stone-300 dark:bg-stone-700 py-1"><div class="row justify-between max-w-prose m-auto px-5"><nav class="row items-center gap-2"><img alt=avatar class=h-12 src=https://purge12.github.io//img/avatar.webp><div><a class=text-xl href=https://purge12.github.io/>home</a><span class=text-xl> > </span><a class=text-xl href=https://purge12.github.io//blog>blog</a><span class=text-xl> > </span><a class=text-xl href=https://purge12.github.io//blog/gsoc-blog-2>gsoc-blog-2</a></div></nav><div class="row items-center gap-3"><button aria-label="theme switch" data-moon-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg>' data-sun-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg>' id=theme-toggle><svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.5 xmlns=http://www.w3.org/2000/svg><path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" stroke-linecap=round stroke-linejoin=round /></svg></button></div></div></div></header><div class="flex justify-center items-center w-full"><main class="max-w-prose px-4 w-full"><div data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
</svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
</svg>' id=copy-cfg style=display:none></div><article class="col w-full" data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 19.5l-15-15m0 0v11.25m0-11.25h11.25" />
</svg>' id=post><section aria-label="Article Info" class="col pt-7 gap-4 mb-10"><h1 class=text-2xl>Problems in version and UDP scanning</h1><div class="row justify-between"><div><span class="text-lg text-stone-400" id=publish>2025-05-25</span></div><div class="flex gap-2"><a class="text-lg tl-link" href=https://purge12.github.io//tags/networks># Networks</a><a class="text-lg tl-link" href=https://purge12.github.io//tags/blog># blog</a></div></div></section><section aria-label="Table of Contents" class="bg-stone-200 dark:bg-stone-800 p-4 rounded-lg mb-10"><h2 class="text-2xl pb-3">Contents:</h2><ul class="col gap-3"><li><a class="text-black dark:text-white text-xl underline underline-offset-8 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" href=#recap>Recap</a><li><a class="text-black dark:text-white text-xl underline underline-offset-8 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" href=#version-scanning-work>Version scanning work</a></ul></section><section aria-label=Article class=tl-prose><h3 id=recap><span class=not-prose> <a aria-label="Anchor link for: recap" class="tl-link text-2xl" href=#recap>#</a> </span> Recap</h3><blockquote><p>Things that are fully implemented (at least as of now, before mentor review):</blockquote><ol><li>branch: <code>patching-sqlalchemy-output</code> –> APSW for SQLite and SQLAlchemy for MySQL and PostgreSQL, integrated with master.<li>branch: <code>adding-wordist-change-option</code> –> Adding the custom wordlist path for enumeration and usernames and passwords (web) integrated with upstream master.<li>branch: <code>keeping-only-new_scan_task</code> –> Using Huey with flask perfectly, including running huey-consumer as a subprocess, integrated with the upstream master.<li>branch: <code>all-new-outputs</code> –> SARIF and DefectDojo output types perfectly done and integrated with master.<li>branch: <code>tests</code> –> Writing all test cases.</ol><blockquote><p>Things that are left to be implemented</blockquote><ol><li>Some test cases<li>version scanning robustness<li>huey for other threading replacements (This will be a pain to integrate with the webdev one…)</ol><hr><p>The plan therefore is to finish tests first. Cause I want to dedicate the maximum efforts during GSoC to version scanning. I will finish tests, then throw everything at that huey implementation, finally when GSoC starts, I only work on version scanning (and other things that the mentor wants me to look at, related to AI I guess :))<p>I realised that the web+huey implementation I was going for that was failing due to<pre class="language-py z-code" data-lang=py><code class=language-py data-lang=py><span class="z-source z-python"><span class="z-meta z-statement z-conditional z-if z-python"><span class="z-keyword z-control z-conditional z-if z-python">if</span> <span class="z-keyword z-operator z-logical z-python">not</span> <span class="z-meta z-qualified-name z-python"><span class="z-variable z-language z-python">self</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">arguments</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">targets</span></span><span class="z-punctuation z-section z-block z-conditional z-if z-python">:</span></span>
</span><span class="z-source z-python">	<span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">log</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">info</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-variable z-language z-python">_</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">no_live_service_found<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">    <span class="z-keyword z-control z-flow z-return z-python">return</span> <span class="z-constant z-language z-python">True</span>
</span><span class="z-source z-python">
</span></code></pre><p>was not a problem in the web part at all. Let me isolate the huey tasks, apply them one by one, and see which one is causing this issue (I mean, there are only two left out techincally, run_engine_task and scan_target_task)<hr><h2 id=version-scanning-work><span class=not-prose> <a aria-label="Anchor link for: version-scanning-work" class="tl-link text-2xl" href=#version-scanning-work>#</a> </span> Version scanning work</h2><p>27th May 2025 New day, gsoc starting time is coming closer and closer. I am thinking, fuck huey and all for now. Let’s devote the next 3 days on version scanning and do that beautifully.<p>branch: <code>code-refactor-version-scan-faster</code><p>I checked it out and it mostly works. I will first rebase this with the upstream master. First order of business. Ahh, wait. I had already done that.<p>Holy cow, just learnt about sliding windows rn. Crazy. I suck at this shit. Fuck, will have to watch some videos.<p>Alright fuck that. So, today’s goal is to fully understand what I had done and the changes I made. I really remember very less about this. Thankfully, I did document some parts of it (hopefully) in <code>docs.md</code> so I will focus on that right now.<blockquote><p>I am officially fcked cause I don’t have the documentation for that. Will have to read the docstrings. Grind on.</blockquote><p>I am thinking I will do the <code>UDP scan</code> part first, because its relatively smaller and it will give me a nice intro to my own code and implementation. The major issue is, I think each thread is running the UDP scan for all the ports inside port.yaml. THIS IS FUCKED.<p>on the contrary, version scanning works? Its the same logic right, so there shouldn’t be a different. Will have to clarify the flow again. Used a little syntactical sugar:<pre class="language-py z-code" data-lang=py><code class=language-py data-lang=py><span class="z-source z-python">    <span class="z-meta z-statement z-loop z-for z-python"><span class="z-keyword z-control z-loop z-for z-python">for</span> <span class="z-meta z-generic-name z-python">entry</span> <span class="z-keyword z-control z-loop z-for z-in z-python">in</span></span><span class="z-meta z-statement z-loop z-for z-python"> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">data</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">get</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">service_logger<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-sequence z-list z-empty z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span></span><span class="z-meta z-statement z-loop z-for z-python"><span class="z-punctuation z-section z-block z-loop z-for z-python">:</span></span>
</span><span class="z-source z-python">        <span class="z-meta z-statement z-conditional z-if z-python"><span class="z-keyword z-control z-conditional z-if z-python">if</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-type z-python">int</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">entry</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">value<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span> <span class="z-keyword z-operator z-comparison z-python">==</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">port_number</span></span><span class="z-punctuation z-section z-block z-conditional z-if z-python">:</span></span>
</span><span class="z-source z-python">            <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">print</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-storage z-type z-string z-python">f</span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-double z-python">inside this if: port_number is: </span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">port_number</span></span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">            <span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">results</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">probes<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">entry</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">get</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">probe<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-sequence z-list z-empty z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">            <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> print(f"probes_list: {results['probes']}")
</span></span><span class="z-source z-python">            <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">matches_list</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">entry</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">get</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">regex<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-sequence z-list z-empty z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">            <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> print(f"matches_list: {matches_list}")
</span></span><span class="z-source z-python">            <span class="z-keyword z-control z-flow z-break z-python">break</span>
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> We can potentially add an optimization here, we can have a for...else block in python.
</span></span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> The idea being that, only when I don't break out of the loop, will this block be executed.
</span></span><span class="z-source z-python">
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> So, earlier I was assigning matches_list as empty each time. Un-necessary overhead. Cause later I am checking
</span></span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> if it has a value and then getting the results list. So, rather than that, I can just do that if I don't break out,
</span></span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> that means entry["value"] != port_number (so, its not the right one) just return empty stuff. Finish it off fast.
</span></span><span class="z-source z-python">    <span class="z-meta z-statement z-conditional z-else z-python"><span class="z-keyword z-control z-conditional z-else z-python">else</span><span class="z-punctuation z-section z-block z-conditional z-else z-python">:</span></span>
</span><span class="z-source z-python">        <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">print</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-storage z-type z-string z-python">f</span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-interpolated z-python"><span class="z-string z-quoted z-double z-python">I came inside else for </span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-begin z-python">{</span><span class="z-source z-python z-embedded"><span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">entry</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">value<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span></span></span><span class="z-meta z-interpolation z-python"><span class="z-punctuation z-section z-interpolation z-end z-python">}</span></span><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">        <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> It doesn't have probes for ports like 3306 (mysql)
</span></span><span class="z-source z-python">        <span class="z-keyword z-control z-flow z-return z-python">return</span> <span class="z-meta z-mapping z-python"><span class="z-punctuation z-section z-mapping z-begin z-python">{</span></span><span class="z-meta z-mapping z-key z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">probes<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-meta z-sequence z-list z-empty z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span> </span><span class="z-meta z-mapping z-key z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">matches<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-meta z-sequence z-list z-empty z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-section z-mapping z-end z-python">}</span></span>
</span></code></pre><p>crazy man, who knew! Also, UDP scanning is not been done on the ports already discovered! Duh, cause the ports discovered are only TCP ones by definition (or rather by how we’re already doing it). Hence, we need to test every port, and hence, we’re calling <code>port_to_probes_and_matches</code> for all ports. Since we are directly using the probes list we don’t have to worry about that, but <code>matches_list</code> requires more parsing and hence I was setting that to be empty for the future if the port is not the right one.<p>So one more optimization that I can think of is using a seperate function for probe extraction from the <code>data</code> through the function inside common.py. I mean, why do we have to extract all probes first and then pass it to another function to get only the UDP parts. okay now that I say it, its the same thing whether I check while parsing or check after parsing. No!!!!!<p>Think about it, in the former case we are going over the list once only, check while parsing. While in the second case, we’re going over it twice. Hmmm. I will look into this prospect.<p>Alright I have made sense of the flow:<ol><li><p>The <code>-sV</code> or <code>-sU</code> flag is specified by the user and read by the program</p><li><p>Inside <code>app.py</code>, if these flags are set, then we call <code>load_yaml</code></p><li><p><code>load_yaml</code> reads the big yaml file and stores that as a variable inside the options</p><li><p>It eventually reaches <code>base.py</code> where I check if udp_scan is needed or if service_scan is needed. In case of both, service scanning is done first, then UDP (according to the flow of the interpreter)</p><li><p>It basically calls the <code>udp_port_scanner</code>, which is an attribute I have assgined to the actual function inside <code>socket.py</code>. To this it passes the entire <code>sub_step</code> which basically contains</p> <ul><li><code>host</code><li><code>port</code><li><code>timeout</code><li>an additional field called <code>data</code> which is the big yaml parsed data</ul><li><p>Now inside UDP scan the first order is to get all the UDP probes inorder to scan. This is does using two functions (at present, I might change this) <code>extract_UDP_probes(port_to_probes_and_matches())</code>. To the inner function, we pass the port number and <code>data</code> which came to us from <code>sub_step</code></p><li><p>This is to extract from the <code>port</code> and <code>data</code>, the probes and the match list along with its other keys. This is done using the <code>port_to_probes_and_matches</code> inside <code>common.py</code>.</p></ol><p>The docstring for the function and the comments are sufficient enough I hope to understand what is going on.<p>This is the raw <code>data</code> for reference. I can’t even print it because it takes so much time! Its big as hell. Even loading it into memory is an exhaustive process.<pre class=z-code><code><span class="z-text z-plain">service_logger:
</span><span class="z-text z-plain">- value: 21
</span><span class="z-text z-plain">  probe:
</span><span class="z-text z-plain">  - Probe TCP GenericLines q|\r\n\r\n|
</span><span class="z-text z-plain">  - Probe TCP Help q|HELP\r\n|
</span><span class="z-text z-plain">  regex: &id002
</span><span class="z-text z-plain">    - 'match acpc m|^Usage: Valid commands are\nLIST\nCLEAR\nSTATUS\nKILL\nNEW\nCONFIG\nAUTONCONNECT\nGETINFO\nHELP\nFor
</span><span class="z-text z-plain">      specific help on each command, type HELP:COMMAND\r\r\n\n| p/Glassfrog computer
</span><span class="z-text z-plain">      poker server/'
</span><span class="z-text z-plain">    - match aleph m|^96\r$| p/Aleph Integrated Library System/
</span><span class="z-text z-plain">    - match bitkeeper m|^@SERVER INFO@\nPROTOCOL=([\d.]+)\nVERSION=bk-([\w._-]+)\nUTC=\d+\nTIME_T=\d+\nROOT=([^\n]+)\nUSER=(?:[^\n]+)\nHOST=(?:[^\n]+)\nREALUSER=(?:[^\n]+)\nREALHOST=([^\n]+)\nPLATFORM=([^\n]+)\n|
</span><span class="z-text z-plain">      p/BitKeeper distributed VCS/ v/$2/ i/protocol $1; root $3; $5/ h/$4/ cpe:/a:bitmover:bitkeeper:$2/
</span><span class="z-text z-plain">    - match chat m|^\r\n>STATUS\tset status\r\nINVISIBLE\tset invisible mode\r\nMAINWINDOW\tshow/hide
</span><span class="z-text z-plain">      main window\r\n| p/Simple Instant Messenger control plugin/
</span><span class="z-text z-plain">    - 'match cvspserver m|^cvs \[pserver aborted\]: bad auth protocol start: HELP\r\n\n?$|
</span><span class="z-text z-plain">      p/cvs pserver/'
</span><span class="z-text z-plain">    - 'match cvspserver m|^cvs \[server aborted\]: bad auth protocol start: HELP\r\n$|
</span><span class="z-text z-plain">      p/CVSNT cvs pserver/ cpe:/a:march-hare:cvsnt/'
</span><span class="z-text z-plain">    - 'match cvspserver m|^cvs \[server aborted\]: bad auth protocol start: HELP\r\nerror  \n$|
</span><span class="z-text z-plain">      p/CVSNT cvs pserver/ cpe:/a:march-hare:cvsnt/'
</span><span class="z-text z-plain">    - 'match cvspserver m|^cvsnt \[server aborted\]: bad auth protocol start: HELP\r\nerror  \n$|
</span><span class="z-text z-plain">      p/CVSNT cvs pserver/ cpe:/a:march-hare:cvsnt/'
</span><span class="z-text z-plain">    - 'match cvspserver m|^cvsntsrv \[server aborted\]: bad auth protocol start: HELP\r\nerror  \n$|
</span><span class="z-text z-plain">      p/CVSNT cvs pserver/ cpe:/a:march-hare:cvsnt/'
</span><span class="z-text z-plain">    - 'match cvspserver m|^cvs-pserver \[pserver aborted\]: bad auth protocol start:
</span><span class="z-text z-plain">      HELP\r\n\n| p/cvs pserver/'
</span><span class="z-text z-plain">    - 'match cvspserver m|^-f \[pserver aborted\]: bad auth protocol start: HELP\r\n\n|
</span><span class="z-text z-plain">      p/SunOS cvs pserver/ o/SunOS/ cpe:/o:sun:sunos/a'
</span><span class="z-text z-plain">    - match echo m|^HELP\r\n$|
</span><span class="z-text z-plain">    - match irc-proxy m|^:ezbounce!srv NOTICE \(unknown\) :\x02| p/ezbounce irc proxy/
</span><span class="z-text z-plain">      o/Unix/
</span><span class="z-text z-plain">    - match ftp m|^220 FTP Server[^[]* \[([\w.-]+)\]\r\n214-The following commands are
</span></code></pre><p>Another problem that I notice here is that, each tread is trying to extract probe and then send it. We shouldn’t do that. Again back to the idea of extracting UDP probes directly. It will solve this issue as well. No more wasted resources. I am all for that.<ol start=8><li>the port_to_probes_and_matches function goes over each <code>value</code> field which is bascially the port number and checks if it matches the one we are CURRENTLY looking for.</ol><p>BRUH THIS IS HIGHLY inefficient. This works for the version_scanning part because we are only testing selective ports there but here!? HERE we have to use ALL the ports. There is absolutely no reason for all threads to keep checking if it matches their port. NAHH. HAVE to change the function now. This is the root cause of all issues.<ol start=9><li>The extracted probes are then used to probe and get a response.</ol><p>Since the process is sooo slow due to the above mentioned inefficiencies, I have never really seen a response from UDP scan :(. Creating a new function now.<hr><p>May 28th<p>I need to get my glasses changed today. Will go at 11am. Mr. Sam sent me his previous talk on nettacker at a conference. Man, I so want to do something similar!<p>He merged two of my PRs yesterday. I will have to factor those in now, but refactoring of <code>ip.py</code> has been done that means I can directly write tests cases for it! Lets go. And postgres fix has also been done, so test case for postgres.py can also be written now. Later later.<p>I got this new function ready. Most of the concurrecy overhead is gone. Yeah, I had small issues here, turns out that using .get(“probes”) was returning a list so my extract_udp_probes function was failing. Just had to do .get(“probes”)[0 and problem solved.<p>NEXT UP:<p>I need to now see how do I make this a part of the port_scan itself or an alternative to see. Something is still a little weird. So, this isn’t <code>really</code> uhh scanning yet in the sense of how port_scan does it. For example, if I close port_scan midway, I quickly get the table, but if I close udp_scan midway I get “no_live_service”. This suggests that the <code>actual</code> process, however may that be defined is not really starting. I will have to debug this out now.<p>I am not returning anything from UDP scan as well. Need to fix that shit. Cause of this, what ends up happening is, as soon as I recieve a response, it fucks the system up. To check this I setup a UDP server using socat<p><code>socat -v UDP-LISTEN:9999,reuseaddr,fork EXEC:'/bin/cat'</code><p>This is a simple echo server.<p>Cool stuff happened, its 3am RN. New day technically, I just realised that I can do filtered port scanning and there was another issue with getservbyport() function of socket that we were using incorrectly. I have a feeling he’s gonna ask me to make two seperate PRs. But they work nicely and it seems like the best way to do it. If you’re unable to create a connection due to a timeout, then it suggests a filtered port. If closed, then the connection will be refused outright.<p>Funny (and sad) thing is I wasn’t even trying to do this and it ended up taking 2 hours :(. That’s just how life be sometimes. I am soooo behind on schedule. Need to get the UDP scan done ASAP!<p>Tomorrow. Hard. Deadline. Finish this or I am not sleeping.<p>Also, this needs a new file now, getting too big.<hr></section></article><hr class="h-px my-10 bg-slate-700 dark:bg-slate-300"><section aria-label="Subscription call-to-action"><div class="col gap-8"><p class="[&>a]:underline [&>a]:underline-offset-4 [&>a]:decoration-2 [&>a]:decoration-sky-500 [&>a]:dark:decoration-sky-400">Did you like this blogpost? Then consider catching up via LinkedIn or Github!<div class="flex gap-5"><form class="col gap-2 w-1/2" onsubmit="window.open('https://buttondown.com/achintya', 'popupwindow')" action=https://buttondown.com/api/emails/embed-subscribe/achintya method=post target=popupwindow><input aria-label="Email input field" class="p-2 bg-stone-300 dark:bg-stone-700n placeholder:text-slate-700 dark:placeholder:text-slate-900" placeholder="Enter your email address" id=bd-email name=email type=email><input class="rounded-md text-black dark:bg-sky-600 p-2 bg-sky-500" type=submit value=Subscribe></form><div class="flex justify-center items-center w-1/2"></div></div></div></section><div class="flex justify-center my-16"><button aria-label="back to top" id=back-to-top><svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.5 xmlns=http://www.w3.org/2000/svg><path d="M12 19.5v-15m0 0l-6.75 6.75M12 4.5l6.75 6.75" stroke-linecap=round stroke-linejoin=round /></svg></button></div><footer class="text-stone-400 dark:text-stone-400 row my-16 text-center"><div class=basis-full><p>© 2024-2025 Achintya Jai</div><div class=basis-full><div>Powered by <a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://www.getzola.org target=_blank>zola</a> and <a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://github.com/TeaDrinkingProgrammer/tranquil target=_blank>tranquil</a></div></div><div class=basis-full><a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://purge12.github.io//privacy target=_blank>Privacy Policy</a></div></footer></main></div><script src=https://purge12.github.io//js/post.js></script><script src=https://purge12.github.io//js/lightense.min.js></script><script src=https://purge12.github.io//js/main.js></script>