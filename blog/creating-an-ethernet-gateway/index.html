<!doctype html><html lang=en><head><script src="https://www.googletagmanager.com/gtag/js?id=G-EKTHKNJH0Q" async></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-EKTHKNJH0Q');</script><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>creating a gateway</title><meta name=description><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/icons/site.webmanifest rel=manifest><link color=#5bbad5 href=/icons/safari-pinned-tab.svg rel=mask-icon><link rel="shortcut icon" href=/icons/favicon.ico><meta content=#00aba9 name=msapplication-TileColor><meta content=/icons/browserconfig.xml name=msapplication-config><meta content=#ffffff name=theme-color><link href=https://purge12.github.io//styles/styles.css rel=stylesheet><script>if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark')
    localStorage.setItem("theme", "dark")
  } else {
    document.documentElement.classList.remove('dark')
    localStorage.setItem("theme", "light")
  }</script><link href=https://purge12.github.io//hl-light.css id=hl rel=stylesheet><body class="antialiased text-slate-700 dark:text-slate-300 bg-white dark:bg-stone-900"><header><div class="bg-stone-300 dark:bg-stone-700 py-1"><div class="row justify-between max-w-prose m-auto px-5"><nav class="row items-center gap-2"><img alt=avatar class=h-12 src=https://purge12.github.io//img/avatar.webp><div><a class=text-xl href=https://purge12.github.io/>home</a><span class=text-xl> > </span><a class=text-xl href=https://purge12.github.io//blog>blog</a><span class=text-xl> > </span><a class=text-xl href=https://purge12.github.io//blog/creating-an-ethernet-gateway>creating-an-ethernet-gateway</a></div></nav><div class="row items-center gap-3"><button aria-label="theme switch" data-moon-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg>' data-sun-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg>' id=theme-toggle><svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.5 xmlns=http://www.w3.org/2000/svg><path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" stroke-linecap=round stroke-linejoin=round /></svg></button></div></div></div></header><div class="flex justify-center items-center w-full"><main class="max-w-prose px-4 w-full"><div data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
</svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
</svg>' id=copy-cfg style=display:none></div><article class="col w-full" data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 19.5l-15-15m0 0v11.25m0-11.25h11.25" />
</svg>' id=post><section aria-label="Article Info" class="col pt-7 gap-4 mb-10"><h1 class=text-2xl>creating a gateway</h1><div class="row justify-between"><div><span class="text-lg text-stone-400" id=publish>2025-04-18</span></div><div class="flex gap-2"><a class="text-lg tl-link" href=https://purge12.github.io//tags/monitoring># Monitoring</a></div></div></section><section aria-label="Table of Contents" class="bg-stone-200 dark:bg-stone-800 p-4 rounded-lg mb-10"><h2 class="text-2xl pb-3">Contents:</h2><ul class="col gap-3"><li><a class="text-black dark:text-white text-xl underline underline-offset-8 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" href=#making-the-webserver-better>Making the webserver better</a><li><a class="text-black dark:text-white text-xl underline underline-offset-8 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" href=#on-to-doing-better>ON TO DOING BETTER</a></ul></section><section aria-label=Article class=tl-prose><p>Update: 20th April, bought one. The adapter has its own network interface inside that is indepedent of the motherboard’s NIC. So, this might work (assuming my LAN cables work)<hr><p>Got this, setting up a static IP address for this interface.<p>old_laptop: 192.168.42.1 new_laptop: 192.168.42.2<p>So, ping works. Next, I will have to enable IP forwarding in my old laptop so that I can handle the traffic properly.<p>This is what I did on my host machine (because the interface shown here was a direct RJ45 connection)<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> ip addr add 192.168.42.2/24 dev eno1</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> ip link set en01 up</span>
</span></code></pre><p>and this is what I did on my old laptop<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> ip addr add 192.168.42.1/24 dev en<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>some_big_ass_string<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> ip link set en<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>some_big_ass_string<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> up</span>
</span></code></pre><p>This was such a weird interface because it uses a USB-to-ethernet adapter. After this ping works.<p>This can act as a proper bridge and hence monitor my logs as well. Pretty useful stuff. BTW pls do ignore if I make some errors here and there, I am pretty drunk.<p>The next step is then to enable IP forwarding. This is basically a single bit that decided whether it needs to be forwarded or not and it can be set in the file, <code>/proc/sys/net/ipv4/ip_forward</code>.<blockquote><p>[!NOTE] So, I have set this up to be a persistent thing, and I am not sure if this was a right choice. Now, if something doesn’t work, later when I don’t want this to work (i hope you get what I mean) then I will surely come back to this as the first point to be checked.</blockquote><hr><p>So, I will now setup my default gateway as the new laptop. This is risky (cause it might mess up shit)<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> ip route add default via 192.168.42.1</span>
</span></code></pre><p>and to revert, we follow this,<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> ip route del default via 192.168.42.1</span>
</span></code></pre><p>Writing this just in case something fails.<p>This needs to be written in the old laptop;<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> iptables<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> nat<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>A</span> POSTROUTING<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> wlp3s0<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>j</span> MASQUERADE</span>
</span></code></pre><p>This is extremely important because this is what ends up setting the rules for the network traffic. That allows forwarding but it isn’t much help unless I manully add a DNS IP.<p>The way this works is:<ul><li>Your router provides an IP + gateway + DNS (via DHCP)<li>Thus, everytime you connect, you get yourself these necessesities including say the local DNS server that might be running, in which case the router acts as a relay to push that to 8.8.8.8 or something.</ul><p>Now in our case, we’ve defined everything statically, so, we’ll have to do the same for the DNS server! This can be done by editing the <code>/etc/resolv.conf</code> file. This means I will rewrite whatever DNS IP the institute router was giving me and saying something like no matter where you wanna go, use 8.8.8.8 or 1.1.1.1.<p>Running on the new one.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> resolvectl dns enx<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>interface<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">8</span>.8.8.8 1.1.1.1</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> resolvectl domain enx<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>interface<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>~.<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><hr><p>For the server files itself, I changed the samba configurations to route via the ethernet interface (goodbye wireless, for now), and I changed my aliases, tested it and its beautiful!<p>Now I have a static IP, I can just plug this ethernet cable and boom network attached storage (wired). Also, the webserver seems to work well. Now the next challenge is to make this persistent, which I have done via the following changes:<ol><li>Persistence for the static IPs over the specific ethernet interface in both laptops</ol><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmcli con add type ethernet ifname eno1 con-name wired-static ip4 192.168.42.2/24 gw4 192.168.42.1</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmcli con mod wired-static ipv4.dns <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>8.8.8.8 1.1.1.1<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmcli con mod wired-static ipv4.method manual</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmcli con up wired-static</span>
</span></code></pre><p>So, in both my laptops its <code>NetworkManager</code> who is doing the “managing” part ig so, we can use nmcli to setup the persistent setups. Similarly, we can do this in the old one.<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Create a static connection profile</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmcli con add type ethernet ifname en<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>name<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> con-name wired-static ip4 192.168.42.1/24</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Set no DHCP and apply now</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmcli con mod wired-static ipv4.method manual</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmcli con up wired-static</span>
</span></code></pre><ol start=2><li>Defined cronjobs for setting up the <code>postrouting</code> rule in the old laptop and <code>gateway</code> setup in the new one on reboot.</ol><p>That should be it. Now as soon as I connect the ethernet cable, I can run <code>get_nas</code> and <code>start_server</code> and I will get everything I need!<hr><h2 id=making-the-webserver-better><span class=not-prose> <a aria-label="Anchor link for: making-the-webserver-better" class="tl-link text-2xl" href=#making-the-webserver-better>#</a> </span> Making the webserver better</h2><p>So, I learnt about <code>tshark</code> which is basically the CLI version of wireshark, and setting that up is easy. First I will have to add that to the sudoers file though<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> visudo</span>
</span></code></pre><p>and inside that,<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">purge</span></span><span class="z-meta z-function-call z-arguments z-shell"> ALL=(ALL</span><span class="z-meta z-function-call z-shell"></span>) <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">NOPASSWD:</span></span><span class="z-meta z-function-call z-arguments z-shell"> /usr/bin/tshark</span>
</span></code></pre><p>Then I can simply define that in <code>app.py</code> and run that nicely. The specific command I want to run is<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> tshark<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> en<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>name<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-punctuation z-terminator z-file-descriptor z-shell">-</span>T json<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Y</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>ip.addr == 192.168.42.2<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></code></pre><p>This gives a nicely formatted json and filters that too. I want to eventually figure out a way to set these filters dynamically, and make the UI for this, as currently its only just printing stuff there.<hr><h2 id=on-to-doing-better><span class=not-prose> <a aria-label="Anchor link for: on-to-doing-better" class="tl-link text-2xl" href=#on-to-doing-better>#</a> </span> ON TO DOING BETTER</h2><p>So, I got my hands on a tplink Archer C50 version 6.8 router. It sadly doesn’t support openWRT but its pretty cool. I set it up to assign static IPs to all devices connected to it. This is done by the <code>binding</code> tne MAC address of the connected device to a IP address. So, within the LAN, all connected devices have known ip addresses.<p>Since this router will also act as a hub, I can connect two devices to it, assign them static IPs and then make them talk to each other. Thus, my NAS is now wireless! (Only need ethernet cables if I have to configure the router).<p>A small skill issue in my side, my room’s ethernet port given by the institute is broken (I am pretty sure these idiots broke it during cleaning for placements or something), so I can’t connect that to wifi yet and forward all the requests. Another thing is that, I will probably have to rethink the traffic monitoring idea now, because my packets are no longer being passed through the old laptop.<p>Pondering…</section></article><hr class="h-px my-10 bg-slate-700 dark:bg-slate-300"><section aria-label="Subscription call-to-action"><div class="col gap-8"><p class="[&>a]:underline [&>a]:underline-offset-4 [&>a]:decoration-2 [&>a]:decoration-sky-500 [&>a]:dark:decoration-sky-400">Did you like this blogpost? Then consider catching up via LinkedIn or Github!<div class="flex gap-5"><form class="col gap-2 w-1/2" onsubmit="window.open('https://buttondown.com/achintya', 'popupwindow')" action=https://buttondown.com/api/emails/embed-subscribe/achintya method=post target=popupwindow><input aria-label="Email input field" class="p-2 bg-stone-300 dark:bg-stone-700n placeholder:text-slate-700 dark:placeholder:text-slate-900" placeholder="Enter your email address" id=bd-email name=email type=email><input class="rounded-md text-black dark:bg-sky-600 p-2 bg-sky-500" type=submit value=Subscribe></form><div class="flex justify-center items-center w-1/2"></div></div></div></section><div class="flex justify-center my-16"><button aria-label="back to top" id=back-to-top><svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor stroke-width=1.5 xmlns=http://www.w3.org/2000/svg><path d="M12 19.5v-15m0 0l-6.75 6.75M12 4.5l6.75 6.75" stroke-linecap=round stroke-linejoin=round /></svg></button></div><footer class="text-stone-400 dark:text-stone-400 row my-16 text-center"><div class=basis-full><p>© 2024-2025 Achintya Jai</div><div class=basis-full><div>Powered by <a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://www.getzola.org target=_blank>zola</a> and <a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://github.com/TeaDrinkingProgrammer/tranquil target=_blank>tranquil</a></div></div><div class=basis-full><a class="text-stone-500 dark:text-stone-300 underline underline-offset-4 decoration-1 hover:decoration-2 decoration-sky-500 dark:decoration-sky-400" rel="noreferrer noopener" href=https://purge12.github.io//privacy target=_blank>Privacy Policy</a></div></footer></main></div><script src=https://purge12.github.io//js/post.js></script><script src=https://purge12.github.io//js/lightense.min.js></script><script src=https://purge12.github.io//js/main.js></script>